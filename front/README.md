# Frontend

This SPA displays a Map centered on the user's position, and displaying the 20 closest restaurants.

## Repo
```bash
.
├── Dockerfile                      # To build the docker image, see below
├── node_modules/                   # All modules used (gitignored)
├── README.md
├── package-lock.json
├── package.json                    # List of node_modules and npm scripts
├── public/                         # favicon, index.html...
├── src
│   ├── App.css                     # CSS for main component. Generated by create-react-app script
│   ├── App.test.tsx                # Test of main component. Generated by create-react-app script
│   ├── App.tsx                     # Main component. Data fetching and state updates are made here
│   ├── AxiosRequest.ts             # Wrapper for axios requests
│   ├── DisplayMapComponent.tsx     # HERE API Map
│   ├── SvgIconsAsStrings.ts        # A way for HERE Scripts to read svg icons (they cannot access public/)
│   ├── index.css                   # CSS for renderer component. Generated by create-react-app script
│   ├── index.tsx                   # Renderer component. Generated by create-react-app script
│   ├── react-app-env.d.ts          # Typescript type declarations. Generated by create-react-app script
│   ├── reportWebVitals.ts          # Metrics logging. Generated by create-react-app script
│   ├── setupTests.ts               # Tests
│   └── types.ts                    # Custom types (Restaurants info, DisplayMapComponent props...)
└── tsconfig.json                   # TS config file. Generated by create-react-app script
```

## HERE API
The DisplayMapComponent is taken from [HERE API doc](https://developer.here.com/tutorials/react/).\

The HERE API also provide a way to retrieve nearby points of interests, but I wanted to discover Google Cloud API, so we use it only to display the map.\

## Dockerfile
There are two stages in the docker file to take advantage of docker cache managment, and end up with a relatively small image.\
In the first stage, we install the dependencies and use the `npm run build` command to create a compact and optimized bundle of folder for our APP.\
In the second stage, we start from an `Nginx` image to act as the web server and proxy for the backend, and we just copy the builded files to a specific location. __BE CAREFUL__, this location must be the same as defined in the [Nginx conf](../docker-data/nginx-conf) (or in the [global env file](../.env.template))


## Env vars & file
The `.env` file defined here is only used in local development (running `npm run start`), because for production all `REACT_APP_*` vars must be defined at Docker buildtime (they cannot be exported by docker-compose `env_file` field) so theses variables are redefined in the [global env file](../.env.template).\
The `.env` file should look like this:
```env
REACT_APP_HERE_API_KEY=areallylongandcomplicatedstringbecauseitisanAPIkey
REACT_APP_BACK_API_URL=https://yourawesome.domain/api

```
Do not forget the trailing `/api` at the end of the `REACT_APP_BACK_API_URL` entry !

## The APP itself
It is a bit ugly, I should have put the data fetching function in some separated component.\
Also, I used the React `useReducer` hook almost as a `useState` hook, so I may have missed something.
